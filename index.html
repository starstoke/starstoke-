<script>
  // Scroll to top on page load
  window.scrollTo(0, 0);

  document.addEventListener('DOMContentLoaded', () => {
    // Initialize Vanta.js with mobile optimization
    try {
      const isMobile = window.innerWidth <= 768;
      let vantaEffect = VANTA.NET({
        el: "#vanta-bg",
        mouseControls: !isMobile,
        touchControls: isMobile,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0xFFF8E1,
        backgroundColor: 0x000000,
        points: isMobile ? 8.0 : 15.0,
        maxDistance: isMobile ? 18.0 : 25.0,
        spacing: isMobile ? 12.0 : 18.0,
        showDots: true,
        lineOpacity: isMobile ? 0.15 : 0.25
      });

      // Simplified Vanta animation for better performance
      if (!isMobile) {
        function animateVanta() {
          if (vantaEffect && vantaEffect.three && vantaEffect.three.camera) {
            vantaEffect.three.camera.rotation.y += 0.0002;
          }
          requestAnimationFrame(animateVanta);
        }
        animateVanta();

        const colors = [0xFFF8E1, 0xFFE0B2, 0xFFCCBC, 0xB2EBF2];
        let currentColorIndex = 0;
        function changeColor() {
          const nextColorIndex = (currentColorIndex + 1) % colors.length;
          const startColor = colors[currentColorIndex];
          const endColor = colors[nextColorIndex];
          let progress = 0;

          function interpolateColor() {
            progress += 0.02;
            if (progress >= 1) {
              currentColorIndex = nextColorIndex;
              vantaEffect.setOptions({ color: endColor, lineOpacity: isMobile ? 0.15 : 0.25 });
              setTimeout(changeColor, 6000);
              return;
            }
            const r = Math.floor((1 - progress) * ((startColor >> 16) & 255) + progress * ((endColor >> 16) & 255));
            const g = Math.floor((1 - progress) * ((startColor >> 8) & 255) + progress * ((endColor >> 8) & 255));
            const b = Math.floor((1 - progress) * (startColor & 255) + progress * (endColor & 255));
            const newColor = (r << 16) + (g << 8) + b;
            vantaEffect.setOptions({ color: newColor, lineOpacity: isMobile ? 0.15 : 0.25 });
            requestAnimationFrame(interpolateColor);
          }
          interpolateColor();
        }
        setTimeout(changeColor, 6000);
      }
    } catch (error) {
      console.error('Vanta.js failed to initialize:', error);
      document.getElementById('vanta-bg').style.background = '#000';
    }

    // Section visibility observer
    const sections = document.querySelectorAll('.section');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, {
      threshold: 0.15,
      rootMargin: '0px 0px -80px 0px'
    });

    sections.forEach(section => observer.observe(section));

    // Smooth scrolling for nav links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const target = document.querySelector(targetId);
        if (target) {
          const offset = 70; // Adjusted for fixed nav height
          const elementPosition = target.getBoundingClientRect().top + window.pageYOffset;
          window.scrollTo({
            top: elementPosition - offset,
            behavior: 'smooth'
          });
        }
      });
    });

    // News banner carousel
    const newsBannerItems = document.querySelectorAll('.news-banner-item');
    const newsBannerControls = document.querySelectorAll('.news-banner-control');
    let currentNewsIndex = 0;

    function showNewsBannerItem(index) {
      newsBannerItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      newsBannerControls.forEach((control, i) => {
        control.classList.toggle('active', i === index);
      });
      currentNewsIndex = index;
    }

    newsBannerControls.forEach((control, index) => {
      control.addEventListener('click', () => showNewsBannerItem(index));
    });

    setInterval(() => {
      const nextNewsIndex = (currentNewsIndex + 1) % newsBannerItems.length;
      showNewsBannerItem(nextNewsIndex);
    }, 6000);

    // Gallery carousel
    const galleryItems = document.querySelectorAll('.gallery-item');
    const galleryControls = document.querySelectorAll('.gallery-control');
    let currentGalleryIndex = 0;

    function showGalleryItem(index) {
      galleryItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      galleryControls.forEach((control, i) => {
        control.classList.toggle('active', i === index);
      });
      currentGalleryIndex = index;
    }

    galleryControls.forEach((control, index) => {
      control.addEventListener('click', () => showGalleryItem(index));
    });

    setInterval(() => {
      const nextGalleryIndex = (currentGalleryIndex + 1) % galleryItems.length;
      showGalleryItem(nextGalleryIndex);
    }, 6000);

    // Merch carousel
    const merchItems = document.querySelectorAll('.merch-item');
    const merchControls = document.querySelectorAll('.merch-control');
    let currentMerchIndex = 0;

    function showMerchItem(index) {
      merchItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      merchControls.forEach((control, i) => {
        control.classList.toggle('active', i === index);
      });
      currentMerchIndex = index;
    }

    merchControls.forEach((control, index) => {
      control.addEventListener('click', () => showMerchItem(index));
    });

    setInterval(() => {
      const nextMerchIndex = (currentMerchIndex + 1) % merchItems.length;
      showMerchItem(nextMerchIndex);
    }, 6000);

    // Artist carousel
    const artistGrid = document.querySelector('.artist-grid');
    const artistCards = document.querySelectorAll('.artist-card');
    const artistControls = document.querySelectorAll('.artist-control');
    let currentArtistIndex = 0;
    const totalArtists = artistCards.length;

    function showArtistItem(index) {
      index = (index + totalArtists) % totalArtists;
      const isMobile = window.innerWidth <= 768;
      const translateValue = isMobile ? -index * 100 : -index * (100 / 3);
      artistGrid.style.transform = `translateX(${translateValue}%)`;
      currentArtistIndex = index;
    }

    artistControls.forEach(control => {
      control.addEventListener('click', () => {
        if (control.classList.contains('prev')) {
          showArtistItem(currentArtistIndex - 1);
        } else if (control.classList.contains('next')) {
          showArtistItem(currentArtistIndex + 1);
        }
      });
    });

    setInterval(() => {
      showArtistItem(currentArtistIndex + 1);
    }, 6000);

    // Handle window resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        showArtistItem(currentArtistIndex);
      }, 100);
    });

    // Currency selector
    const currencyButtons = document.querySelectorAll('.currency-btn');
    const prices = document.querySelectorAll('.card-price .currency');
    currencyButtons.forEach(button => {
      button.addEventListener('click', () => {
        currencyButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        const currency = button.dataset.currency;
        prices.forEach(price => {
          price.textContent = currency;
        });
      });
    });

    // Contact form submission
    const contactForm = document.getElementById('contact-form');
    if (contactForm) {
      contactForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const form = event.target;
        fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          headers: { 'Accept': 'application/json' }
        }).then(response => {
          if (response.ok) {
            alert('Message sent successfully!');
            form.reset();
          } else {
            alert('Error sending message. Please try again.');
          }
        }).catch(error => {
          alert('Error sending message. Please try again.');
        });
      });
    }
  });
</script>