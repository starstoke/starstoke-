<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@0.5.24/dist/vanta.net.min.js"></script>
<script>
  // Scroll to top on page load
  window.scrollTo(0, 0);
  window.addEventListener('load', () => {
    window.scrollTo(0, 0);
  });

  document.addEventListener('DOMContentLoaded', () => {
    // Initialize Vanta.js with mobile optimization
    try {
      const isMobile = window.innerWidth <= 768;
      let vantaEffect = VANTA.NET({
        el: "#vanta-bg",
        mouseControls: !isMobile,
        touchControls: isMobile,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0xFFD700,
        backgroundColor: 0x000000,
        points: isMobile ? 8.0 : 15.0,
        maxDistance: isMobile ? 18.0 : 25.0,
        spacing: isMobile ? 12.0 : 18.0,
        showDots: true,
        lineOpacity: isMobile ? 0.15 : 0.25
      });

      if (!isMobile) {
        function animateVanta() {
          if (vantaEffect && vantaEffect.three && vantaEffect.three.camera) {
            vantaEffect.three.camera.rotation.y += 0.0002;
          }
          requestAnimationFrame(animateVanta);
        }
        animateVanta();

        const colors = [0xFFD700, 0x7DF9FF];
        let currentColorIndex = 0;
        function changeColor() {
          const nextColorIndex = (currentColorIndex + 1) % colors.length;
          const startColor = colors[currentColorIndex];
          const endColor = colors[nextColorIndex];
          let progress = 0;

          function interpolateColor() {
            progress += 0.01; // Slower interpolation
            if (progress >= 1) {
              currentColorIndex = nextColorIndex;
              vantaEffect.setOptions({ color: endColor, lineOpacity: isMobile ? 0.15 : 0.25 });
              setTimeout(changeColor, 10000); // Slower change: 10 seconds
              return;
            }
            const r = Math.floor((1 - progress) * ((startColor >> 16) & 255) + progress * ((endColor >> 16) & 255));
            const g = Math.floor((1 - progress) * ((startColor >> 8) & 255) + progress * ((endColor >> 8) & 255));
            const b = Math.floor((1 - progress) * (startColor & 255) + progress * (endColor & 255));
            const newColor = (r << 16) + (g << 8) + b;
            vantaEffect.setOptions({ color: newColor, lineOpacity: isMobile ? 0.15 : 0.25 });
            requestAnimationFrame(interpolateColor);
          }
          interpolateColor();
        }
        setTimeout(changeColor, 10000);
      }
    } catch (error) {
      console.error('Vanta.js failed to initialize:', error);
      document.getElementById('vanta-bg').style.background = '#000';
    }

    // Section visibility observer
    const sections = document.querySelectorAll('.section');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, {
      threshold: 0.15,
      rootMargin: '0px 0px -80px 0px'
    });

    sections.forEach(section => observer.observe(section));

    // Smooth scrolling for nav links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const target = document.querySelector(targetId);
        if (target) {
          const offset = 70;
          const elementPosition = target.getBoundingClientRect().top + window.pageYOffset;
          window.scrollTo({
            top: elementPosition - offset,
            behavior: 'smooth'
          });
        }
      });
    });

    // News banner carousel
    const newsBannerItems = document.querySelectorAll('.news-banner-item');
    const newsBannerControls = document.querySelectorAll('.news-banner-control');
    let currentNewsIndex = 0;

    function showNewsBannerItem(index) {
      newsBannerItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      newsBannerControls.forEach((control, i) => {
        control.classList.toggle('active', i === index);
      });
      currentNewsIndex = index;
    }

    newsBannerControls.forEach((control, index) => {
      control.addEventListener('click', () => showNewsBannerItem(index));
    });

    setInterval(() => {
      const nextNewsIndex = (currentNewsIndex + 1) % newsBannerItems.length;
      showNewsBannerItem(nextNewsIndex);
    }, 6000);

    // Merch carousel
    const merchItems = document.querySelectorAll('.merch-item');
    const merchControls = document.querySelectorAll('.merch-control');
    let currentMerchIndex = 0;

    function showMerchItem(index) {
      merchItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      merchControls.forEach((control, i) => {
        control.classList.toggle('active', i === index);
      });
      currentMerchIndex = index;
    }

    merchControls.forEach((control, index) => {
      control.addEventListener('click', () => showMerchItem(index));
    });

    setInterval(() => {
      const nextMerchIndex = (currentMerchIndex + 1) % merchItems.length;
      showMerchItem(nextMerchIndex);
    }, 6000);

    // Artist carousel
    const artistItems = document.querySelectorAll('.artist-card');
    const artistControls = document.querySelectorAll('.artist-control');
    let currentArtistIndex = 0;

    function showArtistItem(index) {
      const totalItems = artistItems.length;
      index = (index + totalItems) % totalItems; // Ensure index stays in bounds
      artistItems.forEach((item, i) => {
        item.classList.toggle('active', i === index);
      });
      const translateX = -index * 100;
      document.querySelector('.artist-grid').style.transform = `translateX(${translateX}%)`;
      currentArtistIndex = index;
    }

    artistControls.forEach(control => {
      control.addEventListener('click', () => {
        if (control.classList.contains('prev')) {
          showArtistItem(currentArtistIndex - 1);
        } else if (control.classList.contains('next')) {
          showArtistItem(currentArtistIndex + 1);
        }
      });
    });

    setInterval(() => {
      showArtistItem(currentArtistIndex + 1);
    }, 6000);

    // Initialize first artist as active
    showArtistItem(0);

    // Contact form submission
    const contactForm = document.getElementById('contact-form');
    if (contactForm) {
      contactForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const form = event.target;
        fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          headers: { 'Accept': 'application/json' }
        }).then(response => {
          if (response.ok) {
            alert('Message sent successfully!');
            form.reset();
          } else {
            alert('Error sending message. Please try again.');
          }
        }).catch(error => {
          alert('Error sending message. Please try again.');
        });
      });
    }

    // Artist modal data
    const artists = [
      { 
        name: "Slut Online", 
        bio: "Digital performer and audiovisual music performer. Artistâ€™s work fuses post-internet aesthetics, sensuality, and chaos. Absolutely unique perspective turns every piece into an act of digital intimacy and endurance.", 
        instagram: "https://www.instagram.com/slut0nline?igsh=MXJ4M2xhYmp6d2Fmeg==", 
        spotify: "https://open.spotify.com/artist/5qiD7XFQezJibUa5WMYC1X?si=W0hY9ZmgRD-SJpTRdpUtug", 
        soundcloud: "https://on.soundcloud.com/RTpH2xfFXmwG8SC9Yy" 
      },
      { name: "lindtayl0r", bio: "Bio coming soon...", instagram: "#", spotify: "#", soundcloud: "#" },
      { 
        name: "XSDC", 
        bio: "Born and raised in rural Siberia, duet XS & DC renovate sounds, combining neo-wave lyrics about love, cosmic magnitude and power of simple sound with deep impulsive electronic music.", 
        instagram: "#", 
        spotify: "#", 
        soundcloud: "#" 
      },
      { name: "James Junt", bio: "Bio coming soon...", instagram: "#", spotify: "#", soundcloud: "#" },
      { name: "Vacuum", bio: "Bio coming soon...", instagram: "#", spotify: "#", soundcloud: "#" },
      { name: "NExXxUS", bio: "Bio coming soon...", instagram: "#", spotify: "#", soundcloud: "#" },
      { name: "Keisha Pifagor", bio: "Brooklyn, NYC based sound producer, vocal narrator and songwriter.", instagram: "#", spotify: "#", soundcloud: "#" },
      { name: "blowwindblow", bio: "Bio coming soon...", instagram: "#", spotify: "#", soundcloud: "#" },
      { 
        name: "Ada Metanoia", 
        bio: "Ethereal doom-metal, destined for cross-dimensional walkings, beneath the veil of an unborn past.", 
        socials: "https://band.link/HW5hV" 
      }
    ];

    const modal = document.getElementById('artist-modal');
    const modalSocialButtons = document.getElementById('modal-social-buttons');

    artistItems.forEach(item => {
      item.addEventListener('click', () => {
        const name = item.querySelector('.card-title').textContent;
        const artist = artists.find(a => a.name === name);
        if (artist) {
          document.getElementById('modal-img').src = item.querySelector('img').src;
          document.getElementById('modal-img').alt = artist.name;
          document.getElementById('modal-name').textContent = artist.name;
          document.getElementById('modal-bio').textContent = artist.bio;

          // Clear existing buttons
          modalSocialButtons.innerHTML = '';

          // Populate social buttons based on artist
          if (artist.name === "Ada Metanoia") {
            modalSocialButtons.innerHTML = `
              <a href="${artist.socials}" target="_blank">Socials</a>
            `;
          } else {
            modalSocialButtons.innerHTML = `
              <a id="modal-ig" href="${artist.instagram}" target="_blank">Instagram</a>
              <a id="modal-spotify" href="${artist.spotify}" target="_blank">Spotify</a>
              <a id="modal-sc" href="${artist.soundcloud}" target="_blank">SoundCloud</a>
            `;
          }

          modal.style.display = 'flex';
        }
      });
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
</script>